@model Curso

@{
    ViewData["Title"] = "Detalle del Curso";
}

<div class="detalle-container">
    <div class="detalle-header">
        <h2>@Model.Nombre</h2>
    </div>

    @if (TempData["Success"] != null)
    {
        <div class="alert alert-success">‚úÖ @TempData["Success"]</div>
    }

    @if (TempData["Error"] != null)
    {
        <div class="alert alert-danger">‚ùå @TempData["Error"]</div>
    }

    <div class="detalle-card">
        <div class="card-body">
            <div class="detalle-info">
                <p>
                    <strong>C√≥digo:</strong> @Model.Codigo
                </p>
                <p>
                    <strong>Cr√©ditos:</strong> @Model.Creditos
                </p>
                <p>
                    <strong>Horario:</strong> @Model.HorarioInicio.ToString(@"hh\:mm") - @Model.HorarioFin.ToString(@"hh\:mm")
                </p>
                <p>
                    <strong>Cupo disponible:</strong> 
                    @{
                        var cuposOcupados = Model.Matriculas?.Count(m => m.Estado == EstadoMatricula.Confirmada) ?? 0;
                        var cuposDisponibles = Model.CupoMaximo - cuposOcupados;
                    }
                    <span class="@(cuposDisponibles > 0 ? "cupo-disponible" : "cupo-agotado")">
                        @cuposDisponibles / @Model.CupoMaximo
                    </span>
                </p>
            </div>
            
            @if (User.Identity?.IsAuthenticated == true)
            {
                <form method="post" action="@Url.Action("Inscribir", "Matriculas")">
                    @Html.AntiForgeryToken()
                    <input type="hidden" name="cursoId" value="@Model.Id" />
                    
                    @{
                        var usuarioId = User.FindFirst(System.Security.Claims.ClaimTypes.NameIdentifier)?.Value;
                        var yaInscrito = Model.Matriculas?.Any(m => m.UsuarioId == usuarioId) ?? false;
                    }
                    
                    @if (yaInscrito)
                    {
                        <div class="alert alert-info">
                            <strong>‚úÖ Ya est√° inscrito en este curso.</strong><br>
                            <a href="@Url.Action("MisMatriculas", "Matriculas")" class="alert-link">Ver mis matr√≠culas</a>
                        </div>
                    }
                    else if (cuposDisponibles <= 0)
                    {
                        <button type="button" class="btn btn-secondary w-100" disabled>
                            <span>üö´</span> Cupo Agotado
                        </button>
                    }
                    else
                    {
                        <button type="submit" class="btn btn-success w-100 py-3">
                            <span>üéì</span> Inscribirse en este curso
                        </button>
                    }
                </form>
            }
            else
            {
                <div class="alert alert-warning">
                    <strong>‚ö†Ô∏è Acci√≥n requerida</strong><br>
                    Debe <a href="@Url.Page("/Account/Login", new { area = "Identity", returnUrl = Context.Request.Path })" 
                           class="alert-link">iniciar sesi√≥n</a> para inscribirse en el curso.
                </div>
            }
            
            <div class="botones-accion">
                <a href="@Url.Action("Catalogo", "Cursos")" class="btn btn-secondary">
                    <span>‚Üê</span> Volver al Cat√°logo
                </a>
                @if (User.Identity?.IsAuthenticated == true)
                {
                    <a href="@Url.Action("MisMatriculas", "Matriculas")" class="btn btn-outline-primary">
                        <span>üìã</span> Ver Mis Matr√≠culas
                    </a>
                }
            </div>
        </div>
    </div>
</div>